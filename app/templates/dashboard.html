<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>海洋管理系统 - 主页</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- 侧边导航栏 -->
            <nav id="sidebar" class="col-md-3 col-lg-2 d-md-block bg-dark sidebar collapse">
                <div class="position-sticky pt-3">
                    <div class="text-center mb-4">
                        <h5 class="text-white">海洋管理系统</h5>
                        <p class="text-white-50" id="userInfo">欢迎，<span id="currentUser">{{ username }}</span></p>
                    </div>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link active text-white" href="dashboard.html">
                                <i class="bi bi-speedometer2 me-2"></i>主要信息
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-white" href="underwater.html">
                                <i class="bi bi-water me-2"></i>水下系统
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-white" href="intelligence.html">
                                <i class="bi bi-cpu me-2"></i>智能中心
                            </a>
                        </li>
                        <li class="nav-item" id="adminLink" style="display: none;">
                            <a class="nav-link text-white" href="admin.html">
                                <i class="bi bi-gear me-2"></i>管理员管理
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-white" href="datacenter.html">
                                <i class="bi bi-database me-2"></i>数据中心
                            </a>
                        </li>
                        <li class="nav-item mt-5">
                            <a class="nav-link text-white" href="{{ url_for('auth.logout') }}" id="logoutBtn">
                                <i class="bi bi-box-arrow-right me-2"></i>退出登录
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- 主内容区域 -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">主要信息概览</h1>
                    <div class="btn-toolbar mb-2 mb-md-0">
                        <div class="btn-group me-2">
                            <button type="button" class="btn btn-sm btn-outline-secondary">导出</button>
                            <button type="button" class="btn btn-sm btn-outline-secondary">打印</button>
                        </div>
                        <button type="button" class="btn btn-sm btn-outline-secondary dropdown-toggle">
                            <i class="bi bi-calendar"></i>
                            今日
                        </button>
                    </div>
                </div>

                <!-- 天气信息卡片 -->
                <div class="row mb-4">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header">
                                <h5>当前天气情况</h5>
                            </div>
                            <div class="card-body" id="weatherInfo">
                                <div class="d-flex align-items-center">
                                    <div class="weather-icon me-3">
                                        <i class="bi bi-cloud-sun fs-1"></i>
                                    </div>
                                    <div>
                                        <h3 id="temperature">加载中...</h3>
                                        <p id="weatherDesc">正在获取天气数据</p>
                                    </div>
                                    <div class="ms-auto">
                                        <div class="d-flex flex-column">
                                            <span class="badge bg-primary mb-1" id="humidity">湿度: --</span>
                                            <span class="badge bg-info mb-1" id="wind">风速: --</span>
                                            <span class="badge bg-warning" id="uv">紫外线: --</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <script>
                    // 获取天气数据 - 使用固定位置(北京)
                    fetch('/api/weather/current')
                        .then(response => response.json())
                        .then(data => {
                            if (!data.error) {
                                document.getElementById('temperature').textContent = `${data.temperature}°C`;
                                document.getElementById('weatherDesc').textContent = data.weather_description;
                                document.getElementById('humidity').textContent = `湿度: ${data.humidity}%`;
                                document.getElementById('wind').textContent = `风速: ${data.wind_speed} km/h`;
                                
                                // 获取紫外线指数描述
                                let uvDesc = '低';
                                if (data.uv_index < 3) uvDesc = '低';
                                else if (data.uv_index < 6) uvDesc = '中等';
                                else if (data.uv_index < 8) uvDesc = '高';
                                else if (data.uv_index < 11) uvDesc = '很高';
                                else uvDesc = '极高';
                                
                                document.getElementById('uv').textContent = `紫外线: ${data.uv_index} (${uvDesc})`;
                            }
                        })
                        .catch(error => {
                            console.error('获取天气数据失败:', error);
                        });
                </script>

                <!-- 数据概览卡片 -->
                <div class="row mb-4">
                    <div class="col-md-4">
                        <div class="card text-white bg-primary mb-3">
                            <div class="card-header">水质状况</div>
                            <div class="card-body">
                                <h5 class="card-title">优良</h5>
                                <p class="card-text">pH值: 7.2 | 溶解氧: 8.5mg/L</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card text-white bg-success mb-3">
                            <div class="card-header">鱼类数量</div>
                            <div class="card-body">
                                <h5 class="card-title">12,345</h5>
                                <p class="card-text">较上周增长 5.2%</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card text-white bg-info mb-3">
                            <div class="card-header">设备状态</div>
                            <div class="card-body">
                                <h5 class="card-title">正常运行</h5>
                                <p class="card-text">在线设备: 28/30</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 水质数据图表 -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5>水质数据趋势</h5>
                            </div>
                            <div class="card-body">
                                <canvas id="waterQualityChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5>鱼类分布情况</h5>
                            </div>
                            <div class="card-body">
                                <canvas id="fishDistributionChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 视频监控模块 -->
                <div class="row">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header">
                                <h5>实时监控</h5>
                            </div>
                            <div class="card-body">
                                <div class="ratio ratio-16x9">
                                    <video id="monitorVideo" controls>
                                        <source src="assets/videos/ocean_sample.mp4" type="video/mp4">
                                        您的浏览器不支持视频播放。
                                    </video>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/dashboard.js"></script>
</body>
</html>